<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Track Shipment - Giatech Shipping</title>
  <link rel="stylesheet" href="style.css">

  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
    .progress-container { display: flex; justify-content: center; align-items: center; margin: 20px 0; }
    .progress-step { text-align: center; position: relative; flex: 1; }
    .step-circle { width: 30px; height: 30px; border-radius: 50%; background: #ccc; margin: auto; display: flex; justify-content: center; align-items: center; color: #fff; font-weight: bold; }
    .progress-step.active .step-circle { background: #007bff; }
    .progress-line { flex: 1; height: 4px; background: #ccc; margin: 0 5px; }
    .progress-step.active ~ .progress-line { background: #007bff; }
    #proof-container img { max-width: 300px; border-radius: 8px; margin-top: 10px; cursor: pointer; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>

  <h1>Track Your Shipment</h1>

  <!-- Tracking Form -->
  <input type="text" id="trackingNumber" placeholder="Enter Tracking Number">
  <button onclick="trackShipment()">Track</button>

  <!-- Tracking Result -->
  <<div id="result" class="result-box" style="display: none;">
  <h2>Tracking Result</h2>
  <p><strong>Tracking ID:</strong> <span id="res-id"></span></p>
  <p><strong>Last Updated:</strong> <span id="res-updated"></span></p>

  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-step" id="step-1">
      <div class="step-circle">1</div>
      <div class="step-label">Order Placed</div>
    </div>
    <div class="progress-line"></div>
    <div class="progress-step" id="step-2">
      <div class="step-circle">2</div>
      <div class="step-label">Processing</div>
    </div>
    <div class="progress-line"></div>
    <div class="progress-step" id="step-3">
      <div class="step-circle">3</div>
      <div class="step-label">Shipped</div>
    </div>
    <div class="progress-line"></div>
    <div class="progress-step" id="step-4">
      <div class="step-circle">4</div>
      <div class="step-label">Delivered</div>
    </div>
  </div>
</div>


  <!-- Proof Upload Display -->
  <div id="proof-container"></div>

  <!-- Lightbox for Proof Image -->
  <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
      background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;">
    <img id="lightbox-img" src="" alt="Proof Preview" style="max-width:90%; max-height:90%; border-radius:10px;">
  </div>

  <script>
    // üîπ Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD4rtE-D8HT4BxUjAz-opq1S2y8OeXzBXw",
      authDomain: "giatech-shipping.firebaseapp.com",
      databaseURL: "https://giatech-shipping-default-rtdb.firebaseio.com",
      projectId: "giatech-shipping",
      storageBucket: "giatech-shipping.firebasestorage.app",
      messagingSenderId: "906996624627",
      appId: "1:906996624627:web:9d8b8cfa4e210202009b86"
    };

    // üîπ Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // üîπ Function to Track Shipment
    function trackShipment() {
      const trackingNumber = document.getElementById("trackingNumber").value.trim();
      const resultDiv = document.getElementById("trackingResult");
      const proofContainer = document.getElementById("proof-container");

      if (!trackingNumber) {
        resultDiv.innerHTML = "<p style='color:red;'>‚ö† Please enter a tracking number</p>";
        return;
      }

      const shipmentRef = db.ref("shipments/" + trackingNumber);
      shipmentRef.on("value", (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          resultDiv.innerHTML = `
            <h3>Tracking Number: ${trackingNumber}</h3>
            <p><strong>Status:</strong> ${data.status}</p>
            <p><strong>Location:</strong> ${data.location}</p>
            <p><strong>Last Updated:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
          `;

          // Reset progress
          document.querySelectorAll(".progress-step").forEach(step => step.classList.remove("active"));

          // Activate progress steps dynamically
          if (data.status === "Order Placed") document.getElementById("step1").classList.add("active");
          if (data.status === "Processing") { document.getElementById("step1").classList.add("active"); document.getElementById("step2").classList.add("active"); }
          if (data.status === "Shipped") { document.getElementById("step1").classList.add("active"); document.getElementById("step2").classList.add("active"); document.getElementById("step3").classList.add("active"); }
          if (data.status === "Delivered") { document.getElementById("step1").classList.add("active"); document.getElementById("step2").classList.add("active"); document.getElementById("step3").classList.add("active"); document.getElementById("step4").classList.add("active"); }

          // Proof upload preview
          if (data.proof) {
            if (data.proof.match(/\.(jpg|jpeg|png)$/i)) {
              proofContainer.innerHTML = `<p><strong>Delivery Proof:</strong></p>
                                          <img src="${data.proof}" alt="Proof" id="proof-img">`;
              document.getElementById("proof-img").onclick = () => {
                document.getElementById("lightbox").style.display = "flex";
                document.getElementById("lightbox-img").src = data.proof;
              };
            } else if (data.proof.endsWith(".pdf")) {
              proofContainer.innerHTML = `<p><strong>Delivery Proof:</strong> 
                                          <a href="${data.proof}" target="_blank">üìé View PDF</a></p>`;
            } else {
              proofContainer.innerHTML = `<p><strong>Delivery Proof:</strong> 
                                          <a href="${data.proof}" target="_blank">üìé Download File</a></p>`;
            }
          } else {
            proofContainer.innerHTML = "";
          }

        } else {
          resultDiv.innerHTML = "<p style='color:red;'>‚ùå No shipment found for this tracking number</p>";
          proofContainer.innerHTML = "";
        }
      });
    }

    // üîπ Close lightbox on click
    document.getElementById("lightbox").onclick = (e) => {
      if (e.target.id === "lightbox" || e.target.id === "lightbox-img") {
        document.getElementById("lightbox").style.display = "none";
      }
    };
  </script>

</body>
</html>
